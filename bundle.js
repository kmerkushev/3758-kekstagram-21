(()=>{"use strict";window.getRandomInt=(e,t)=>(e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e)})(),(()=>{let e;window.debounce=t=>{e&&window.clearTimeout(e),e=window.setTimeout(t,500)}})(),document.querySelector("#upload-select-image"),window.getData=(e,t)=>{let r=new XMLHttpRequest;r.responseType="json",r.open("GET","https://21.javascript.pages.academy/kekstagram/data"),r.timeout=2e3,r.addEventListener("load",(()=>{e(r.response)})),r.addEventListener("error",(()=>{t("Произошла ошибка соединения")})),r.addEventListener("timeout",(()=>{t("Запрос не успел выполниться за "+r.timeout+"мс")})),r.send()},window.sendData=(e,t,r)=>{let n=new XMLHttpRequest;n.responseType="json",n.addEventListener("load",(function(){t()})),n.open("POST","https://21.javascript.pages.academy/kekstagram"),n.send(e)},(()=>{"use strict";let e=e=>{let t=document.querySelector("#picture").content.querySelector("a"),r=document.createDocumentFragment(),n=document.querySelector(".pictures");for(let n=0;n<e.length;n++){let o=t.cloneNode(!0);o.dataset.id=n,o.querySelector(".picture__img").src=e[n].url,o.querySelector(".picture__likes").textContent=e[n].likes,o.querySelector(".picture__comments").textContent=e[n].comments.length,r.appendChild(o)}n.appendChild(r)},t=()=>{let e=document.querySelector(".pictures").querySelectorAll(".picture");for(let t=0;t<e.length;t++)e[t].parentNode.removeChild(e[t])};window.renderPictures=t=>{e(t)},window.clearPictures=()=>{t()},window.updatePictures=r=>{t(),e(r)}})(),(()=>{let e=document.querySelector(".big-picture"),t=document.querySelector(".big-picture__img"),r=document.querySelector(".social"),n=(document.querySelector(".big-picture__preview"),document.querySelector(".big-picture__cancel"),!1),o=document.querySelector(".big-picture.overlay"),c=document.querySelector(".social__comment-count"),l=document.querySelector(".comments-loader"),d=document.querySelector("#picture-cancel"),i=document.querySelector(".social__footer-text"),s=!1,a=document.querySelector(".pictures"),u=e=>{"Escape"!==e.key||s||(e.preventDefault(),p())},m=()=>{n=!0},y=e=>{n?n=!1:p()},p=()=>{e.classList.add("hidden"),c.classList.remove("hidden"),l.classList.remove("hidden"),document.removeEventListener("keydown",u),o.removeEventListener("click",y),t.removeEventListener("click",m),r.removeEventListener("click",m),n=!1},g=n=>{let a;if(n.target.matches(".picture__img")||n.target.matches(".picture__info"))a=n.target.parentNode.dataset.id;else if(n.target.matches(".picture__comments")||n.target.matches(".picture__likes"))a=n.target.parentNode.parentNode.dataset.id;else{if(!n.target.matches(".picture"))return;a=n.target.dataset.id}var g;e.classList.remove("hidden"),c.classList.add("hidden"),l.classList.add("hidden"),i.addEventListener("focus",(()=>{s=!0})),i.addEventListener("blur",(()=>{s=!1})),document.addEventListener("keydown",u),o.addEventListener("click",y),t.addEventListener("click",m),r.addEventListener("click",m),d.addEventListener("click",(()=>{p()})),g=window.data[a],e.querySelector(".big-picture__img").querySelector("img").src=g.url,e.querySelector(".big-picture__img").querySelector("img").alt=g.description,e.querySelector(".social__caption").textContent=g.description,e.querySelector(".likes-count").textContent=g.likes,e.querySelector(".comments-count").textContent=g.comments.length,(e=>{let t=document.querySelector(".social__comments");t.innerHTML="";let r=document.querySelector("#social__comment").content.querySelector("li"),n=document.createDocumentFragment(),o=0,c=o+5,l=document.querySelector(".comments-loader"),d=()=>{e.length<=c&&(c=e.length,l.removeEventListener("click",d),l.classList.add("hidden"));for(let t=o;t<c;t++){let o=r.cloneNode(!0);o.querySelector("img").src=e[t].avatar,o.querySelector("img").alt=e[t].name,o.querySelector("p").textContent=e[t].message,n.appendChild(o)}t.appendChild(n),o=document.querySelectorAll(".social__comment").length,c=o+5-1};e.length>5&&(l.classList.remove("hidden"),l.addEventListener("click",d)),d()})(g.comments)};a.addEventListener("click",(e=>{g(e)})),a.addEventListener("keydown",(e=>{"Enter"===e.key&&g(e)}))})(),(()=>{let e=!1,t=!1,r=!1,n=document.querySelector(".effects__list"),o=n.querySelector("#effect-none"),c=document.querySelector(".effect-level"),l=document.querySelector(".effect-level__value"),d=document.querySelector(".effect-level__pin"),i=document.querySelector(".effect-level__depth"),s=document.querySelector(".effect-level__line"),a=document.querySelector(".img-upload__preview"),u="effect-none",m=document.querySelector("#upload-select-image");document.querySelector("#upload-submit"),c.classList.add("visually-hidden");let y=(e,t)=>{let r=e/100;if("effect-none"===t)a.style="",c.classList.add("visually-hidden");else{switch(t){case"effect-chrome":a.style="filter:grayscale("+r+"); ";break;case"effect-sepia":a.style="filter:sepia("+r+"); ";break;case"effect-marvin":r=e,a.style="filter:invert("+r+"%); ";break;case"effect-phobos":r=Math.round(e/100*3),a.style="filter:blur("+r+"px); ";break;case"effect-heat":r=Math.round(e/100*2+1),a.style="filter:brightness("+r+"); "}c.classList.remove("visually-hidden")}p(e),l.value=e},p=e=>{d.style.left=e+"%",i.style.width=e+"%"},g=e=>{let t=(e=>{let t=Math.round(e.clientX-(e=>{let t=e.getBoundingClientRect();return{x:t.left+pageXOffset,center:t.left+pageXOffset+t.width/2}})(s).x),r=parseInt(getComputedStyle(s).width,10),n=Math.round(t/r*100);return n<=0?n=0:n>=100&&(n=100),n})(e);y(t,u)};n.addEventListener("change",(e=>{u=e.target.id,y(20,e.target.id)})),d.addEventListener("mousedown",(()=>{document.addEventListener("mousemove",g),document.addEventListener("mouseup",(()=>{document.removeEventListener("mousemove",g)}))}));let v=document.querySelector(".text__description"),h=document.querySelector(".text__hashtags"),f=!1,_=e=>{let t=!1;for(let r=0;r<e.length;r++)for(let n=r+1;n<e.length;n++)if(e[r]===e[n]){t=!0;break}return t};h.addEventListener("input",(()=>{(()=>{let e=h.value.toLowerCase().split(" "),t=/^#[a-zA-Z\d]*$/;for(let r=0;r<e.length;r++)e.length>5?h.setCustomValidity("Нельзя указать больше пяти хэш-тегов"):t.test(e[r])?1===e[r].length?h.setCustomValidity("Хеш-тег не может состоять только из одной решётки"):e[r].length>20?h.setCustomValidity("Максимальная длина одного хэш-тега 20 символов, включая решётку"):e.length>1&&_(e)?h.setCustomValidity("Один и тот же хэш-тег не может быть использован дважды"):h.setCustomValidity(""):"#"!==e[r][0]?h.setCustomValidity("Хеш-тег должен начинаться с #"):h.setCustomValidity("Хеш-тег должен состоять только из букв и цифр"),h.reportValidity()})()})),h.addEventListener("focus",(()=>{f=!0})),h.addEventListener("blur",(()=>{f=!1})),window.hashtagInputIsFocused=f;let q=r=>{let n=document.querySelector("main"),o=document.querySelector(`#${r}`).content.querySelector("section"),c=document.createDocumentFragment(),l=o.cloneNode(!0);l.classList.add("visually-hidden"),c.appendChild(l),n.appendChild(l),"success"===r?e=!0:"error"===r&&(t=!0),n.querySelector(`.${r}__button`).addEventListener("click",(()=>{L(`${r}`)}))},S=e=>{let t=document.querySelector(`.${e}`);t.classList.remove("visually-hidden"),r=!0,document.addEventListener("keydown",(e=>{"Escape"===e.key&&r&&L()})),t.addEventListener("click",(t=>{r&&t.target!=document.querySelector(`.${e}__inner`)&&t.target!=document.querySelector(`.${e}__title`)&&t.target!=document.querySelector(`.${e}__button`)&&t.target!=document.querySelector(`.${e}__inner`)&&L(`${e}`)}))},L=e=>{document.querySelector(`.${e}`).classList.add("visually-hidden"),r=!1},w=()=>{window.closePopup(),e||q("success"),S("success")},E=e=>{window.closePopup(),t||q("error"),S("error")},k=()=>{o.checked=!0,a.style="",p(20),c.classList.add("visually-hidden"),l.value=20,h.value="",v.value=""};m.addEventListener("submit",(e=>{e.preventDefault(),window.sendData(new FormData(m),w,E),k()})),window.clearForm=()=>{k()}})(),(()=>{let e=document.querySelector(".img-filters"),t=e.querySelector("#filter-default"),r=e.querySelector("#filter-random"),n=e.querySelector("#filter-discussed");window.getData((o=>{e.classList.remove("img-filters--inactive"),window.data=o,window.renderPictures(o);let c=e=>{let c=[];if(document.querySelector(".img-filters__button--active").classList.toggle("img-filters__button--active"),e.target.classList.toggle("img-filters__button--active"),e.target===t)c=o;else if(e.target===r){let e=[],t=o.slice();for(let r=0;r<10;r++){let r=window.getRandomInt(0,t.length);e.push(t[r]),t.splice(r,1)}c=e}else if(e.target===n){let e=(e,t)=>e.comments.length<t.comments.length?1:e.comments.length==t.comments.length?0:e.comments.length>t.comments.length?-1:void 0;c=o.slice().sort(e)}update=()=>{updatePictures(c)},debounce(update)};t.addEventListener("click",c),r.addEventListener("click",c),n.addEventListener("click",c)}),(e=>{console.log(e)}))})(),(()=>{"use strict";let e=document.querySelector("#upload-cancel"),t=document.querySelector("#upload-file"),r=document.querySelector(".img-upload__overlay"),n=e=>{"Escape"!==e.key||hashtagInputIsFocused||c()};t.addEventListener("change",(()=>{o()})),e.addEventListener("click",(()=>{c()}));let o=()=>{r.classList.remove("hidden"),document.body.classList.add("modal-open"),document.addEventListener("keydown",n)},c=()=>{t.value="",r.classList.add("hidden"),document.body.classList.remove("modal-open"),document.removeEventListener("keydown",n),window.clearForm()};window.openPopup=()=>{o()},window.closePopup=()=>{c()}})();